{% extends "base.html" %}
{% load static %}


{% block content %}
	<!-- Start Banner Area -->
	<section class="banner-area organic-breadcrumb">
		<div class="container">
			<div class="breadcrumb-banner d-flex flex-wrap align-items-center justify-content-end">
				<div class="col-first">
					<h1>{{ single_product.product_name}}</h1>
				</div>
			</div>
		</div>
	</section>
	<!-- End Banner Area -->

	<!--================Single Product Area =================-->
	<div class="product_image_area">
		<div class="container">
			<div class="row s_product_inner">
				<div class="col-lg-6">
					<div class="s_Product_carousel">
						<div class="single-prd-item">
							<img class="img-fluid" src="{{ single_product.images.url}}" alt="">
						</div>
						<div class="single-prd-item">
							<img class="img-fluid" src="img/category/s-p1.jpg" alt="">
						</div>
						<div class="single-prd-item">
							<img class="img-fluid" src="img/category/s-p1.jpg" alt="">
						</div>
					</div>
				</div>
				<div class="col-lg-5 offset-lg-1">
					<div class="s_product_text">
						<h3>{{single_product.product_name}}</h3>
						<h2>₦{{single_product.price}}</h2>
						<ul class="list">
							<li><a class="active" href="#"><span>Category</span> : {{single_product.category}}</a></li>
							<li><a href="#"><span>Availibility</span> : {{single_product.stock}} In Stock</a></li>
						</ul>
						<p>{{single_product.description}}</p>
						<div class="product_count">
							<label for="qty">Quantity:</label>
							<input type="text" name="qty" id="sst" maxlength="12" value="1" title="Quantity:" class="input-text qty">
							<button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst )) result.value++;return false;"
							 class="increase items-count" type="button"><i class="lnr lnr-chevron-up"></i></button>
							<button onclick="var result = document.getElementById('sst'); var sst = result.value; if( !isNaN( sst ) &amp;&amp; sst > 0 ) result.value--;return false;"
							 class="reduced items-count" type="button"><i class="lnr lnr-chevron-down"></i></button>
						</div>
						<div class="card_area d-flex align-items-center">
							{% if single_product.stock == 0 %}
								<a class="primary-btn" href="#">Out of Stock</a>
							{% elif in_cart %}
								<a class="primary-btn" href="#"><i class="lnr lnr-cart mr-2"></i>In your Cart</a>
								<a class="btn btn-primary mr-2" href="{% url 'cart' %}">View Cart <i class="lnr lnr-eye mr-2"></i></a>
							{% else %}
								<a class="primary-btn" href="#" onclick="addToCartAjax({{ single_product.id }}); return false;">Add to Cart</a>
							{% endif %}
							<a class="icon_btn" href="#"><i class="lnr lnr lnr-heart"></i></a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--================End Single Product Area =================-->

	<!--================Product Description Area =================-->
	<section class="product_description_area">
		<div class="container">
			<ul class="nav nav-tabs" id="myTab" role="tablist">
				<li class="nav-item">
					<a class="nav-link" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Description</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="profile-tab" data-toggle="tab" href="#profile" role="tab" aria-controls="profile"
					 aria-selected="false">Specification</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="contact-tab" data-toggle="tab" href="#contact" role="tab" aria-controls="contact"
					 aria-selected="false">Comments</a>
				</li>
				<li class="nav-item">
					<a class="nav-link active" id="review-tab" data-toggle="tab" href="#review" role="tab" aria-controls="review"
					 aria-selected="false">Reviews</a>
				</li>
			</ul>
			<div class="tab-content" id="myTabContent">
				<div class="tab-pane fade" id="home" role="tabpanel" aria-labelledby="home-tab">
					<p>{{ single_product.description}}</p>
				</div>
				<div class="tab-pane fade" id="profile" role="tabpanel" aria-labelledby="profile-tab">
					<div class="table-responsive">
						<table class="table">
							<tbody>
								<tr>
									<td>
										<h5>Width</h5>
									</td>
									<td>
										<h5>128mm</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>Height</h5>
									</td>
									<td>
										<h5>508mm</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>Depth</h5>
									</td>
									<td>
										<h5>85mm</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>Weight</h5>
									</td>
									<td>
										<h5>52gm</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>Quality checking</h5>
									</td>
									<td>
										<h5>yes</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>Freshness Duration</h5>
									</td>
									<td>
										<h5>03days</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>When packeting</h5>
									</td>
									<td>
										<h5>Without touch of hand</h5>
									</td>
								</tr>
								<tr>
									<td>
										<h5>Each Box contains</h5>
									</td>
									<td>
										<h5>60pcs</h5>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
				<div class="tab-pane fade" id="contact" role="tabpanel" aria-labelledby="contact-tab">
					<div class="row">
						<div class="col-lg-6">
							<div class="comment_list">
								<div class="review_item">
									<div class="media">
										<div class="d-flex">
											<img src="img/product/review-1.png" alt="">
										</div>
										<div class="media-body">
											<h4>Blake Ruiz</h4>
											<h5>12th Feb, 2018 at 05:56 pm</h5>
											<a class="reply_btn" href="#">Reply</a>
										</div>
									</div>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
										dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
										commodo</p>
								</div>
								<div class="review_item reply">
									<div class="media">
										<div class="d-flex">
											<img src="img/product/review-2.png" alt="">
										</div>
										<div class="media-body">
											<h4>Blake Ruiz</h4>
											<h5>12th Feb, 2018 at 05:56 pm</h5>
											<a class="reply_btn" href="#">Reply</a>
										</div>
									</div>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
										dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
										commodo</p>
								</div>
								<div class="review_item">
									<div class="media">
										<div class="d-flex">
											<img src="img/product/review-3.png" alt="">
										</div>
										<div class="media-body">
											<h4>Blake Ruiz</h4>
											<h5>12th Feb, 2018 at 05:56 pm</h5>
											<a class="reply_btn" href="#">Reply</a>
										</div>
									</div>
									<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et
										dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea
										commodo</p>
								</div>
							</div>
						</div>
						<div class="col-lg-6">
							<div class="review_box">
								<h4>Post a comment</h4>
								<form class="row contact_form" action="contact_process.php" method="post" id="contactForm" novalidate="novalidate">
									<div class="col-md-12">
										<div class="form-group">
											<input type="text" class="form-control" id="name" name="name" placeholder="Your Full name">
										</div>
									</div>
									<div class="col-md-12">
										<div class="form-group">
											<input type="email" class="form-control" id="email" name="email" placeholder="Email Address">
										</div>
									</div>
									<div class="col-md-12">
										<div class="form-group">
											<input type="text" class="form-control" id="number" name="number" placeholder="Phone Number">
										</div>
									</div>
									<div class="col-md-12">
										<div class="form-group">
											<textarea class="form-control" name="message" id="message" rows="1" placeholder="Message"></textarea>
										</div>
									</div>
									<div class="col-md-12 text-right">
										<button type="submit" value="submit" class="btn primary-btn">Submit Now</button>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
				<div class="tab-pane fade show active" id="review" role="tabpanel" aria-labelledby="review-tab">
					<div class="row">
						<div class="col-lg-6">
							<div class="row total_rate">
								<div class="col-6">
									<div class="box_total">
										<h5>Overall</h5>
										<h4>{{ average_rating|floatformat:1 }}</h4>
										<h6>({{ review_count }} Review{{ review_count|pluralize }})</h6>
									</div>
								</div>
								<div class="col-6">
									<div class="rating_list">
										<h3>Based on {{ review_count }} Review{{ review_count|pluralize }}</h3>
										<ul class="list">
											<li><a href="#">5 Star
												{% for i in "12345" %}<i class="fa fa-star"></i>{% endfor %}
												{{ rating_counts.5 }}
											</a></li>
											<li><a href="#">4 Star
												{% for i in "1234" %}<i class="fa fa-star"></i>{% endfor %}<i class="fa fa-star-o"></i>
												{{ rating_counts.4 }}
											</a></li>
											<li><a href="#">3 Star
												{% for i in "123" %}<i class="fa fa-star"></i>{% endfor %}{% for i in "12" %}<i class="fa fa-star-o"></i>{% endfor %}
												{{ rating_counts.3 }}
											</a></li>
											<li><a href="#">2 Star
												{% for i in "12" %}<i class="fa fa-star"></i>{% endfor %}{% for i in "123" %}<i class="fa fa-star-o"></i>{% endfor %}
												{{ rating_counts.2 }}
											</a></li>
											<li><a href="#">1 Star
												<i class="fa fa-star"></i>{% for i in "1234" %}<i class="fa fa-star-o"></i>{% endfor %}
												{{ rating_counts.1 }}
											</a></li>
										</ul>
									</div>
								</div>
							</div>
							<div class="review_list">
								{% if reviews %}
									{% for review in reviews %}
									<div class="review_item">
										<div class="media">
											<div class="d-flex">
												<div class="user-avatar">
													<i class="fa fa-user-circle" style="font-size: 50px; color: #ccc;"></i>
												</div>
											</div>
											<div class="media-body">
												<h4>{{ review.user.first_name }} {{ review.user.last_name }}</h4>
												<div class="rating-stars">
													{% for i in "12345" %}
														{% if forloop.counter <= review.rating %}
															<i class="fa fa-star"></i>
														{% else %}
															<i class="fa fa-star-o"></i>
														{% endif %}
													{% endfor %}
												</div>
												<h5>{{ review.created_at|date:"jS M, Y \a\t h:i A" }}</h5>
												{% if review.subject %}
													<h6><strong>{{ review.subject }}</strong></h6>
												{% endif %}
											</div>
										</div>
										<p>{{ review.review }}</p>
									</div>
									{% endfor %}
								{% else %}
									<div class="review_item">
										<p class="text-center">No reviews yet. Be the first to review this product!</p>
									</div>
								{% endif %}
							</div>
						</div>
						<div class="col-lg-6">
							<div class="review_box">
								{% if user.is_authenticated %}
									{% if user_review %}
										<h4>Your Review</h4>
										<div class="existing-review">
											<div class="rating-stars mb-2">
												{% for i in "12345" %}
													{% if forloop.counter <= user_review.rating %}
														<i class="fa fa-star"></i>
													{% else %}
														<i class="fa fa-star-o"></i>
													{% endif %}
												{% endfor %}
											</div>
											{% if user_review.subject %}
												<h6><strong>{{ user_review.subject }}</strong></h6>
											{% endif %}
											<p>{{ user_review.review }}</p>
											<small class="text-muted">Reviewed on {{ user_review.created_at|date:"jS M, Y" }}</small>
											<hr>
											<h5>Update Your Review</h5>
										</div>
									{% else %}
										<h4>Add a Review</h4>
									{% endif %}

									{% if can_review or user_review %}
										<form method="post" action="{% url 'submit_review' single_product.id %}">
											{% csrf_token %}
											<div class="form-group">
												<label for="{{ review_form.rating.id_for_label }}">Your Rating:</label>
												{{ review_form.rating }}
											</div>
											<div class="form-group">
												<label for="{{ review_form.subject.id_for_label }}">Subject (Optional):</label>
												{{ review_form.subject }}
											</div>
											<div class="form-group">
												<label for="{{ review_form.review.id_for_label }}">Your Review:</label>
												{{ review_form.review }}
											</div>
											<div class="text-right">
												<button type="submit" class="btn primary-btn">
													{% if user_review %}Update Review{% else %}Submit Review{% endif %}
												</button>
											</div>
										</form>
									{% else %}
										<p class="text-center">You can leave a review for this product.</p>
									{% endif %}
								{% else %}
									<h4>Add a Review</h4>
									<p class="text-center">
										<a href="{% url 'login' %}" class="btn primary-btn">Login to Review</a>
									</p>
								{% endif %}
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!--================End Product Description Area =================-->

	<style>
	/* Review Section Styling */
	.rating-stars {
		color: #ffba00;
		margin-bottom: 10px;
	}

	.rating-stars i {
		margin-right: 2px;
	}

	.user-avatar {
		margin-right: 15px;
	}

	.existing-review {
		background: #f8f9fa;
		padding: 15px;
		border-radius: 5px;
		margin-bottom: 20px;
	}

	.review_box .form-group {
		margin-bottom: 20px;
	}

	.review_box label {
		font-weight: 500;
		color: #333;
		margin-bottom: 8px;
		display: block;
	}

	.review_item {
		border-bottom: 1px solid #eee;
		padding-bottom: 20px;
		margin-bottom: 20px;
	}

	.review_item:last-child {
		border-bottom: none;
		margin-bottom: 0;
	}

	.review_item .media-body h4 {
		color: #333;
		font-size: 16px;
		margin-bottom: 5px;
	}

	.review_item .media-body h5 {
		color: #777;
		font-size: 12px;
		margin-bottom: 5px;
	}

	.review_item .media-body h6 {
		color: #555;
		font-size: 14px;
		margin-bottom: 10px;
	}

	.review_item p {
		color: #666;
		line-height: 1.6;
		margin-top: 10px;
	}
	</style>

	<!-- Start related-product Area -->
	<section class="related-product-area section_gap_bottom">
		<div class="container">
			<div class="row justify-content-center">
				<div class="col-lg-6 text-center">
					<div class="section-title">
						<h1>Deals of the Week</h1>
						<p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore
							magna aliqua.</p>
					</div>
				</div>
			</div>
			<div class="row">
				<div class="col">
					<div class="row">
						{% if deals_week_products %}
						{% for product in deals_week_products %}
						<div class="col-lg-3 col-md-6">
							<div class="single-product">
								<img class="img-fluid" src="{{ product.images.url }}" alt="{{ product.product_name }}">
								<div class="product-details">
									<h6>{{ product.product_name }}</h6>
									<div class="price">
										<h6>₦{{ product.price }}</h6>
									</div>
									<div class="prd-bottom">

										<a href="{% url 'add_cart' product.id %}" class="social-info">
											<span class="ti-bag"></span>
											<p class="hover-text">add to bag</p>
										</a>
										<a href="{{product.get_url}}" class="social-info">
											<span class="lnr lnr-move"></span>
											<p class="hover-text">view more</p>
										</a>
									</div>
								</div>
							</div>
						</div>
						{% endfor %}
						{% else %}
							<h1 class="">No products available.</h1>
						{% endif %}
					</div>
						
				</div>
				<div class="col-lg-3">
					<div class="ctg-right">
						<a href="#" target="_blank">
							<img class="img-fluid d-block mx-auto" src="img/category/c5.jpg" alt="">
						</a>
					</div>
				</div>
			</div>
		</div>
	</section>
	<!-- End related-product Area -->
<!-- Product Detail AJAX Script -->
<script>
function addToCartAjax(productId) {
    const button = event.target;
    const originalText = button.textContent;

    // Show loading state
    button.textContent = 'Adding...';
    button.disabled = true;

    fetch(`/cart/add_cart_ajax/${productId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update cart badge using global function
            if (typeof updateCartBadge === 'function') {
                updateCartBadge(data.cart_count);
            }

            // Show success feedback
            button.textContent = 'Added!';
            button.style.background = '#28a745';

            // Reload page after 1 second to show "In Cart" state
            setTimeout(() => {
                location.reload();
            }, 1000);
        } else {
            // Show error
            button.textContent = 'Error!';
            button.style.background = '#dc3545';

            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
                button.disabled = false;
            }, 2000);
        }
    })
    .catch(error => {
        console.log('Error adding to cart:', error);
        button.textContent = 'Error!';
        button.style.background = '#dc3545';

        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '';
            button.disabled = false;
        }, 2000);
    });
}
</script>

<!-- Product Detail AJAX Script -->
<script>
function addToCartAjax(productId) {
    const button = event.target;
    const originalText = button.textContent;

    // Show loading state
    button.textContent = 'Adding...';
    button.disabled = true;

    fetch(`/cart/add_cart_ajax/${productId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCookie('csrftoken'),
        },
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update cart badge using global function
            if (typeof updateCartBadge === 'function') {
                updateCartBadge(data.cart_count);
            }

            // Show success feedback
            button.textContent = 'Added!';
            button.style.background = '#28a745';

            // Reload page after 1 second to show "In Cart" state
            setTimeout(() => {
                location.reload();
            }, 1000);
        } else {
            // Show error
            button.textContent = 'Error!';
            button.style.background = '#dc3545';

            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
                button.disabled = false;
            }, 2000);
        }
    })
    .catch(error => {
        console.log('Error adding to cart:', error);
        button.textContent = 'Error!';
        button.style.background = '#dc3545';

        setTimeout(() => {
            button.textContent = originalText;
            button.style.background = '';
            button.disabled = false;
        }, 2000);
    });
}
</script>

{% endblock content %}
</body>

</html>